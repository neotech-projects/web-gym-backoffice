<!-- start page title -->
<div class="row">
    <div class="col-12">
        <div class="page-title-box d-sm-flex align-items-center justify-content-between">
            <h4 class="mb-sm-0">Dashboard Backoffice</h4>

            <div class="page-title-right">
                <ol class="breadcrumb m-0">
                    <li class="breadcrumb-item"><a routerLink="/backoffice/dashboard">Home</a></li>
                    <li class="breadcrumb-item active">Dashboard</li>
                </ol>
            </div>
        </div>
    </div>
</div>
<!-- end page title -->

<div class="row">
    <div class="col-xl-6 col-md-6">
        <div class="card card-animate">
            <div class="card-body">
                <div class="d-flex align-items-center">
                    <div class="flex-grow-1 overflow-hidden">
                        <p class="text-uppercase fw-medium text-muted text-truncate mb-0">Prenotazioni Settimanali</p>
                    </div>
                    <div class="flex-shrink-0">
                        <h5 class="text-info fs-14 mb-0">
                            <i class="ri-arrow-up-line fs-13 align-middle"></i> +15
                        </h5>
                    </div>
                </div>
                <div class="d-flex align-items-end justify-content-between mt-4">
                    <div>
                        <h4 class="fs-22 fw-semibold ff-secondary mb-4"><span>{{ bookingsCount }}</span></h4>
                        <a routerLink="/backoffice/gestisci-prenotazioni" class="text-decoration-underline text-muted mb-0">Questa settimana</a>
                    </div>
                    <div class="avatar-sm flex-shrink-0">
                        <span class="avatar-title bg-info-subtle rounded fs-3">
                            <i class="ri-calendar-check-line text-info"></i>
                        </span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="col-xl-6 col-md-6">
        <div class="card card-animate">
            <div class="card-body">
                <div class="d-flex align-items-center">
                    <div class="flex-grow-1 overflow-hidden">
                        <p class="text-uppercase fw-medium text-muted text-truncate mb-0">Presenze Mensili</p>
                    </div>
                    <div class="flex-shrink-0">
                        <h5 class="text-warning fs-14 mb-0">
                            <i class="ri-arrow-up-line fs-13 align-middle"></i> +8
                        </h5>
                    </div>
                </div>
                <div class="d-flex align-items-end justify-content-between mt-4">
                    <div>
                        <h4 class="fs-22 fw-semibold ff-secondary mb-4"><span>{{ workoutsCount }}</span></h4>
                        <a routerLink="/backoffice/gestisci-utenti" class="text-decoration-underline text-muted mb-0">Visualizza utenti</a>
                    </div>
                    <div class="avatar-sm flex-shrink-0">
                        <span class="avatar-title bg-warning-subtle rounded fs-3">
                            <i class="ri-group-line text-warning"></i>
                        </span>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="row">
    <div class="col-xl-6 col-md-6">
        <div class="card card-animate">
            <div class="card-body">
                <div class="d-flex align-items-center">
                    <div class="flex-grow-1 overflow-hidden">
                        <p class="text-uppercase fw-medium text-muted text-truncate mb-0">Presenze Attuali</p>
                    </div>
                    <div class="flex-shrink-0">
                        <span [class]="currentPresenceBadgeClass">{{ currentPresenceBadge }}</span>
                    </div>
                </div>
                <div class="d-flex align-items-end justify-content-between mt-4">
                    <div>
                        <h4 class="fs-22 fw-semibold ff-secondary mb-4"><span>{{ currentPresencesCount }}</span></h4>
                        <a href="#" class="text-decoration-underline text-muted mb-0" style="visibility: hidden; pointer-events: none;">Visualizza presenze</a>
                    </div>
                    <div class="avatar-sm flex-shrink-0">
                        <span class="avatar-title bg-success-subtle rounded fs-3">
                            <i class="ri-user-location-line text-success"></i>
                        </span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="col-xl-6 col-md-6">
        <div class="card card-animate">
            <div class="card-body">
                <div class="d-flex align-items-center">
                    <div class="flex-grow-1 overflow-hidden">
                        <p class="text-uppercase fw-medium text-muted text-truncate mb-0">Apri Porta</p>
                    </div>
                </div>
                <div class="d-flex align-items-end justify-content-between mt-4">
                    <div>
                        <div class="mb-4" style="height: 26px; display: flex; align-items: center;">
                            <button type="button" class="btn btn-soft-primary" (click)="openDoor()" id="openDoorBtn" style="transform: translateY(30px);">
                                <i class="ri-door-open-line me-2"></i> Apri Porta
                            </button>
                        </div>
                        <a href="#" class="text-decoration-underline text-muted mb-0" style="visibility: hidden;">Spazio</a>
                    </div>
                    <div class="avatar-sm flex-shrink-0">
                        <span class="avatar-title rounded fs-3" style="background-color: #f0f2f5;">
                            <img src="assets/images/porta2.png" alt="Apri Porta" style="width: 24px; height: 24px; object-fit: contain; display: block;">
                        </span>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="row">
    <div class="col-xl-12">
        <div class="card">
            <div class="card-header align-items-center d-flex">
                <h4 class="card-title mb-0 flex-grow-1">Presenze Attuali</h4>
            </div>
            <div class="card-body">
                <div *ngIf="currentPresencesList.length === 0" class="text-center py-4">
                    <p class="text-muted mb-0">Nessuna presenza al momento</p>
                </div>
                <div *ngIf="currentPresencesList.length > 0" class="d-flex flex-wrap gap-2">
                    <span *ngFor="let presence of currentPresencesList" 
                          (click)="openPresenceModal(presence)"
                          class="badge bg-primary-subtle text-primary fs-13 px-3 py-2 d-inline-flex align-items-center presence-badge-clickable" 
                          style="font-weight: 500; line-height: 1.5; cursor: pointer;">
                        <div class="avatar-xs me-2 d-flex align-items-center" style="flex-shrink: 0;">
                            <div class="avatar-title bg-primary text-white rounded-circle d-flex align-items-center justify-content-center" style="font-size: 0.65rem; width: 20px; height: 20px; line-height: 1;">
                                {{ getInitials(presence.fullName) }}
                            </div>
                        </div>
                        <span class="d-flex align-items-center">{{ presence.fullName }}</span>
                    </span>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Modal Riepilogo Prossima Prenotazione -->
<div class="modal fade" id="nextBookingModal" tabindex="-1" aria-labelledby="nextBookingModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header bg-primary-subtle">
                <h5 class="modal-title" id="nextBookingModalLabel">Prossima Prenotazione</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="mb-3">
                    <label class="form-label fw-semibold">Data</label>
                    <input type="text" class="form-control" id="nextBookingDate" disabled>
                </div>
                <div class="row mb-3">
                    <div class="col-6">
                        <label class="form-label fw-semibold">Ora Inizio</label>
                        <input type="text" class="form-control" id="nextBookingStartTime" disabled>
                    </div>
                    <div class="col-6">
                        <label class="form-label fw-semibold">Ora Fine</label>
                        <input type="text" class="form-control" id="nextBookingEndTime" disabled>
                    </div>
                </div>
                <div class="alert alert-info" role="alert">
                    <i class="ri-time-line me-2"></i>
                    <strong>Durata:</strong> <span id="nextBookingDuration">1h</span>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-soft-secondary" data-bs-dismiss="modal">Chiudi</button>
                <a routerLink="/backoffice/gestisci-prenotazioni" class="btn btn-primary">Vai alle Prenotazioni</a>
            </div>
        </div>
    </div>
</div>

<!-- Modal Informazioni Prenotazione -->
<div class="modal fade" id="presenceBookingModal" tabindex="-1" aria-labelledby="presenceBookingModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header bg-primary-subtle">
                <h5 class="modal-title" id="presenceBookingModalLabel">
                    <i class="ri-user-line me-2"></i>
                    Informazioni Prenotazione
                </h5>
                <button type="button" class="btn-close" (click)="closePresenceModal()" aria-label="Chiudi"></button>
            </div>
            <div class="modal-body" *ngIf="selectedPresence">
                <div class="mb-3">
                    <div class="d-flex align-items-center mb-3">
                        <div class="avatar-sm me-3">
                            <div class="avatar-title bg-primary text-white rounded-circle">
                                {{ getInitials(selectedPresence.fullName) }}
                            </div>
                        </div>
                        <div>
                            <h6 class="mb-0">{{ selectedPresence.fullName }}</h6>
                            <small class="text-muted">{{ selectedPresence.company || 'N/A' }}</small>
                        </div>
                    </div>
                </div>
                
                <div class="mb-3">
                    <label class="form-label fw-semibold">
                        <i class="ri-time-line me-2"></i>Orario Prenotazione
                    </label>
                    <div class="alert alert-info mb-0">
                        <strong>{{ selectedPresence.bookingStartTime || 'N/A' }}</strong> - 
                        <strong>{{ selectedPresence.bookingEndTime || 'N/A' }}</strong>
                    </div>
                </div>

                <div class="mb-3">
                    <label class="form-label fw-semibold">
                        <i class="ri-timer-line me-2"></i>Durata
                    </label>
                    <div class="alert alert-info mb-0">
                        <strong>{{ selectedPresence.bookingDuration || 'N/A' }}</strong>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-soft-secondary" (click)="closePresenceModal()">Chiudi</button>
            </div>
        </div>
    </div>
</div>

<!--start back-to-top-->
<button (click)="scrollToTop()" class="btn btn-danger btn-icon" id="back-to-top">
    <i class="ri-arrow-up-line"></i>
</button>
<!--end back-to-top-->
