import{a,b as i,h as s,i as o,k as n,la as c,n as p,q as h}from"./chunk-GFW33JLT.js";var v=class l{constructor(t){this.http=t}API_URL="/api/operators";MOCK_URL="/assets/mock/operators.json";serverAvailable=!0;lastCheck=0;CHECK_INTERVAL=6e4;isServerAvailable(){let t=Date.now();return t-this.lastCheck>this.CHECK_INTERVAL&&(this.lastCheck=t),this.serverAvailable}handleConnectionError(t,e){let r=t.status===0,b=t.message?.includes("parsing")||t.error instanceof ProgressEvent;return r||b?(this.serverAvailable=!1,(this.lastCheck===0||Date.now()-this.lastCheck>this.CHECK_INTERVAL)&&(console.info("Microservizio non disponibile, uso dati mock locali"),this.lastCheck=Date.now()),e()):t.status&&t.status>=400?(this.serverAvailable=!1,(this.lastCheck===0||Date.now()-this.lastCheck>this.CHECK_INTERVAL)&&(console.info("Microservizio non disponibile, uso dati mock locali"),this.lastCheck=Date.now()),e()):(console.warn("Errore nella chiamata al microservizio:",t.message),this.serverAvailable=!1,e())}getOperators(){return this.isServerAvailable()?this.http.get(this.API_URL,{headers:{Accept:"application/json"}}).pipe(o(t=>{if(t.success&&t.data)return this.serverAvailable=!0,t.data.map(e=>i(a({},e),{birthdateDisplay:e.birthdate?new Date(e.birthdate).toLocaleDateString("it-IT"):void 0}));throw new Error(t.message||"Invalid response format")}),n(t=>t.status===404?(this.serverAvailable=!1,this.getMockOperators()):this.handleConnectionError(t,()=>this.getMockOperators()))):this.getMockOperators()}getMockOperators(){return this.http.get(this.MOCK_URL).pipe(o(t=>t.map(e=>i(a({},e),{birthdateDisplay:e.birthdate?new Date(e.birthdate).toLocaleDateString("it-IT"):void 0}))),n(t=>(console.error("Errore nel caricamento del mock:",t),s([]))))}createOperator(t){return this.isServerAvailable()?this.http.post(this.API_URL,t).pipe(o(e=>{if(e.success&&e.data)return this.serverAvailable=!0,i(a({},e.data),{birthdateDisplay:e.data.birthdate?new Date(e.data.birthdate).toLocaleDateString("it-IT"):void 0});throw new Error(e.message||"Invalid response format")}),n(e=>s(i(a({},t),{id:Date.now()})))):s(i(a({},t),{id:Date.now()}))}updateOperator(t,e){return this.isServerAvailable()?this.http.put(`${this.API_URL}/${t}`,e).pipe(o(r=>{if(r.success&&r.data)return this.serverAvailable=!0,i(a({},r.data),{birthdateDisplay:r.data.birthdate?new Date(r.data.birthdate).toLocaleDateString("it-IT"):void 0});throw new Error(r.message||"Invalid response format")}),n(r=>s(i(a({},e),{id:t})))):s(i(a({},e),{id:t}))}deleteOperator(t){return this.isServerAvailable()?this.http.delete(`${this.API_URL}/${t}`).pipe(o(e=>(this.serverAvailable=!0,e.success)),n(e=>s(!0))):s(!0)}static \u0275fac=function(e){return new(e||l)(h(c))};static \u0275prov=p({token:l,factory:l.\u0275fac,providedIn:"root"})};export{v as a};
