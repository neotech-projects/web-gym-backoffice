import{a as L}from"./chunk-Y5DSX2WP.js";import{D as l,E as P,M as D,N as t,O as e,P as o,R as b,U as n,V as m,aa as h,c as C,ca as w,h as S,i as d,k as p,ka as y,la as A,ma as I,n as E,na as z,oa as M,pa as O,q as k,qa as T,r as x,ra as _,s as u,ta as B}from"./chunk-GFW33JLT.js";var v=class r{title="Palestra Backoffice";static \u0275fac=function(a){return new(a||r)};static \u0275cmp=u({type:r,selectors:[["app-root"]],standalone:!0,features:[h],decls:1,vars:0,template:function(a,s){a&1&&o(0,"router-outlet")},dependencies:[O],styles:[".container[_ngcontent-%COMP%]{max-width:1200px;margin:0 auto;padding:2rem}header[_ngcontent-%COMP%]{text-align:center;margin-bottom:2rem}header[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{color:#1976d2;font-size:2.5rem;margin:0}main[_ngcontent-%COMP%]{text-align:center;padding:2rem}main[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:1.2rem;color:#666}"]})};var f=class r{constructor(i){this.http=i}API_URL="/api/dashboard/stats";MOCK_URL="/assets/mock/dashboard-stats.json";serverAvailable=!0;lastCheck=0;CHECK_INTERVAL=6e4;isServerAvailable(){let i=Date.now();return i-this.lastCheck>this.CHECK_INTERVAL&&(this.lastCheck=i),this.serverAvailable}handleConnectionError(i,a){let s=i.status===0,c=i.message?.includes("parsing")||i.error instanceof ProgressEvent;return s||c?(this.serverAvailable=!1,(this.lastCheck===0||Date.now()-this.lastCheck>this.CHECK_INTERVAL)&&(console.info("Microservizio non disponibile, uso dati mock locali"),this.lastCheck=Date.now()),a()):i.status&&i.status>=400?(this.serverAvailable=!1,(this.lastCheck===0||Date.now()-this.lastCheck>this.CHECK_INTERVAL)&&(console.info("Microservizio non disponibile, uso dati mock locali"),this.lastCheck=Date.now()),a()):(console.warn("Errore nella chiamata al microservizio:",i.message),this.serverAvailable=!1,a())}getDashboardStats(){return this.isServerAvailable()?this.http.get(this.API_URL,{}).pipe(d(i=>{if(i.success&&i.data)return this.serverAvailable=!0,i.data;throw new Error(i.message||"Invalid response format")}),p(i=>this.handleConnectionError(i,()=>this.getMockStats()))):this.getMockStats()}getMockStats(){return this.http.get(this.MOCK_URL).pipe(p(i=>(console.error("Errore nel caricamento del mock:",i),S({weeklyBookings:15,monthlyPresences:28,currentPresences:0,lastUpdate:new Date().toISOString()}))))}getCurrentPresences(){return this.isServerAvailable()?this.http.get(`${this.API_URL}/current-presences`).pipe(d(i=>(this.serverAvailable=!0,i.currentPresences)),p(i=>this.handleConnectionError(i,()=>this.getMockStats().pipe(d(a=>a.currentPresences))))):this.getMockStats().pipe(d(i=>i.currentPresences))}static \u0275fac=function(a){return new(a||r)(k(A))};static \u0275prov=E({token:r,factory:r.\u0275fac,providedIn:"root"})};var g=class r{constructor(i){this.dashboardService=i}bookingsCount=0;workoutsCount=0;currentPresencesCount=0;currentPresenceBadge="In tempo reale";currentPresenceBadgeClass="badge bg-success-subtle text-success";isLoading=!0;intervalId;subscriptions=new C;ngOnInit(){this.loadDashboardData(),this.intervalId=setInterval(()=>this.updateCurrentPresences(),3e4)}ngOnDestroy(){this.intervalId&&clearInterval(this.intervalId),this.subscriptions.unsubscribe()}get currentYear(){return new Date().getFullYear()}loadDashboardData(){this.isLoading=!0;let i=this.dashboardService.getDashboardStats().subscribe({next:a=>{this.bookingsCount=a.weeklyBookings,this.workoutsCount=a.monthlyPresences,this.currentPresencesCount=a.currentPresences,this.updatePresenceBadge(),this.isLoading=!1},error:a=>{console.error("Errore nel caricamento dei dati della dashboard:",a),this.isLoading=!1}});this.subscriptions.add(i)}updateCurrentPresences(){let i=this.dashboardService.getCurrentPresences().subscribe({next:a=>{this.currentPresencesCount=a,this.updatePresenceBadge()},error:a=>{console.error("Errore nell'aggiornamento delle presenze:",a)}});this.subscriptions.add(i)}updatePresenceBadge(){this.currentPresencesCount>0?(this.currentPresenceBadge="In tempo reale",this.currentPresenceBadgeClass="badge bg-success-subtle text-success"):(this.currentPresenceBadge="Nessuna presenza",this.currentPresenceBadgeClass="badge bg-secondary-subtle text-secondary")}viewCurrentPresences(i){i&&i.preventDefault(),this.currentPresencesCount===0?alert("Attualmente non ci sono persone in palestra."):alert(`Attualmente ci sono ${this.currentPresencesCount} ${this.currentPresencesCount===1?"persona":"persone"} in palestra.

In produzione, qui verrebbe mostrata una lista dettagliata degli utenti presenti.`)}openDoor(){let i=document.getElementById("openDoorBtn");if(i){let a=i.innerHTML;i.setAttribute("disabled","true"),i.innerHTML='<span class="spinner-border spinner-border-sm me-2"></span> Apertura...',setTimeout(()=>{alert("\u2713 Porta aperta con successo!"),i.removeAttribute("disabled"),i.innerHTML=a},1500)}}scrollToTop(){window.scrollTo({top:0,behavior:"smooth"})}static \u0275fac=function(a){return new(a||r)(P(f))};static \u0275cmp=u({type:r,selectors:[["app-dashboard"]],standalone:!0,features:[h],decls:215,vars:6,consts:[[1,"row"],[1,"col-12"],[1,"page-title-box","d-sm-flex","align-items-center","justify-content-between"],[1,"mb-sm-0"],[1,"page-title-right"],[1,"breadcrumb","m-0"],[1,"breadcrumb-item"],["routerLink","/backoffice/dashboard"],[1,"breadcrumb-item","active"],[1,"col-xl-6","col-md-6"],[1,"card","card-animate"],[1,"card-body"],[1,"d-flex","align-items-center"],[1,"flex-grow-1","overflow-hidden"],[1,"text-uppercase","fw-medium","text-muted","text-truncate","mb-0"],[1,"flex-shrink-0"],[1,"text-info","fs-14","mb-0"],[1,"ri-arrow-up-line","fs-13","align-middle"],[1,"d-flex","align-items-end","justify-content-between","mt-4"],[1,"fs-22","fw-semibold","ff-secondary","mb-4"],["routerLink","/backoffice/gestisci-prenotazioni",1,"text-decoration-underline","text-muted","mb-0"],[1,"avatar-sm","flex-shrink-0"],[1,"avatar-title","bg-info-subtle","rounded","fs-3"],[1,"ri-calendar-check-line","text-info"],[1,"text-warning","fs-14","mb-0"],["routerLink","/backoffice/gestisci-utenti",1,"text-decoration-underline","text-muted","mb-0"],[1,"avatar-title","bg-warning-subtle","rounded","fs-3"],[1,"ri-group-line","text-warning"],["href","#",1,"text-decoration-underline","text-muted","mb-0",3,"click"],[1,"avatar-title","bg-success-subtle","rounded","fs-3"],[1,"ri-user-location-line","text-success"],[1,"mb-4",2,"height","26px","display","flex","align-items","center"],["type","button","id","openDoorBtn",1,"btn","btn-soft-primary",2,"transform","translateY(30px)",3,"click"],[1,"ri-door-open-line","me-2"],["href","#",1,"text-decoration-underline","text-muted","mb-0",2,"visibility","hidden"],[1,"avatar-title","rounded","fs-3",2,"background-color","#f0f2f5"],["src","assets/images/porta2.png","alt","Apri Porta",2,"width","24px","height","24px","object-fit","contain","display","block"],[1,"col-xl-12"],[1,"card"],[1,"card-header","align-items-center","d-flex"],[1,"card-title","mb-0","flex-grow-1"],["routerLink","/backoffice/gestisci-prenotazioni",1,"btn","btn-soft-info","btn-sm"],[1,"table-responsive","table-card"],[1,"table","table-borderless","table-hover","table-nowrap","align-middle","mb-0"],["scope","col"],[1,"avatar-xs","me-2"],[1,"avatar-title","bg-primary-subtle","text-primary","rounded-circle"],[1,"badge","bg-success-subtle","text-success"],["type","button",1,"btn","btn-sm","btn-soft-danger"],[1,"avatar-title","bg-success-subtle","text-success","rounded-circle"],[1,"avatar-title","bg-warning-subtle","text-warning","rounded-circle"],["id","nextBookingModal","tabindex","-1","aria-labelledby","nextBookingModalLabel","aria-hidden","true",1,"modal","fade"],[1,"modal-dialog","modal-dialog-centered"],[1,"modal-content"],[1,"modal-header","bg-primary-subtle"],["id","nextBookingModalLabel",1,"modal-title"],["type","button","data-bs-dismiss","modal","aria-label","Close",1,"btn-close"],[1,"modal-body"],[1,"mb-3"],[1,"form-label","fw-semibold"],["type","text","id","nextBookingDate","disabled","",1,"form-control"],[1,"row","mb-3"],[1,"col-6"],["type","text","id","nextBookingStartTime","disabled","",1,"form-control"],["type","text","id","nextBookingEndTime","disabled","",1,"form-control"],["role","alert",1,"alert","alert-info"],[1,"ri-time-line","me-2"],["id","nextBookingDuration"],[1,"modal-footer"],["type","button","data-bs-dismiss","modal",1,"btn","btn-soft-secondary"],["routerLink","/backoffice/gestisci-prenotazioni",1,"btn","btn-primary"],["id","back-to-top",1,"btn","btn-danger","btn-icon",3,"click"],[1,"ri-arrow-up-line"]],template:function(a,s){a&1&&(t(0,"div",0)(1,"div",1)(2,"div",2)(3,"h4",3),n(4,"Dashboard Backoffice"),e(),t(5,"div",4)(6,"ol",5)(7,"li",6)(8,"a",7),n(9,"Home"),e()(),t(10,"li",8),n(11,"Dashboard"),e()()()()()(),t(12,"div",0)(13,"div",9)(14,"div",10)(15,"div",11)(16,"div",12)(17,"div",13)(18,"p",14),n(19,"Prenotazioni Settimanali"),e()(),t(20,"div",15)(21,"h5",16),o(22,"i",17),n(23," +15 "),e()()(),t(24,"div",18)(25,"div")(26,"h4",19)(27,"span"),n(28),e()(),t(29,"a",20),n(30,"Questa settimana"),e()(),t(31,"div",21)(32,"span",22),o(33,"i",23),e()()()()()(),t(34,"div",9)(35,"div",10)(36,"div",11)(37,"div",12)(38,"div",13)(39,"p",14),n(40,"Presenze Mensili"),e()(),t(41,"div",15)(42,"h5",24),o(43,"i",17),n(44," +8 "),e()()(),t(45,"div",18)(46,"div")(47,"h4",19)(48,"span"),n(49),e()(),t(50,"a",25),n(51,"Visualizza utenti"),e()(),t(52,"div",21)(53,"span",26),o(54,"i",27),e()()()()()()(),t(55,"div",0)(56,"div",9)(57,"div",10)(58,"div",11)(59,"div",12)(60,"div",13)(61,"p",14),n(62,"Presenze Attuali"),e()(),t(63,"div",15)(64,"span"),n(65),e()()(),t(66,"div",18)(67,"div")(68,"h4",19)(69,"span"),n(70),e()(),t(71,"a",28),b("click",function(j){return s.viewCurrentPresences(j)}),n(72,"Visualizza presenze"),e()(),t(73,"div",21)(74,"span",29),o(75,"i",30),e()()()()()(),t(76,"div",9)(77,"div",10)(78,"div",11)(79,"div",12)(80,"div",13)(81,"p",14),n(82,"Apri Porta"),e()()(),t(83,"div",18)(84,"div")(85,"div",31)(86,"button",32),b("click",function(){return s.openDoor()}),o(87,"i",33),n(88," Apri Porta "),e()(),t(89,"a",34),n(90,"Spazio"),e()(),t(91,"div",21)(92,"span",35),o(93,"img",36),e()()()()()()(),t(94,"div",0)(95,"div",37)(96,"div",38)(97,"div",39)(98,"h4",40),n(99,"Prenotazioni della Settimana"),e(),t(100,"div",15)(101,"a",41),n(102,"Vedi tutte"),e()()(),t(103,"div",11)(104,"div",42)(105,"table",43)(106,"thead")(107,"tr")(108,"th",44),n(109,"Utente"),e(),t(110,"th",44),n(111,"Data"),e(),t(112,"th",44),n(113,"Orario"),e(),t(114,"th",44),n(115,"Durata"),e(),t(116,"th",44),n(117,"Stato"),e(),t(118,"th",44),n(119,"Azioni"),e()()(),t(120,"tbody")(121,"tr")(122,"td")(123,"div",12)(124,"div",45)(125,"div",46),n(126,"MR"),e()(),t(127,"span"),n(128,"Mario Rossi"),e()()(),t(129,"td"),n(130,"Domani"),e(),t(131,"td"),n(132,"10:00 - 11:00"),e(),t(133,"td"),n(134,"1h"),e(),t(135,"td")(136,"span",47),n(137,"Confermata"),e()(),t(138,"td")(139,"button",48),n(140,"Annulla"),e()()(),t(141,"tr")(142,"td")(143,"div",12)(144,"div",45)(145,"div",49),n(146,"LB"),e()(),t(147,"span"),n(148,"Laura Bianchi"),e()()(),t(149,"td"),n(150,"Tra 2 giorni"),e(),t(151,"td"),n(152,"14:00 - 15:30"),e(),t(153,"td"),n(154,"1h 30m"),e(),t(155,"td")(156,"span",47),n(157,"Confermata"),e()(),t(158,"td")(159,"button",48),n(160,"Annulla"),e()()(),t(161,"tr")(162,"td")(163,"div",12)(164,"div",45)(165,"div",50),n(166,"GV"),e()(),t(167,"span"),n(168,"Giovanni Verdi"),e()()(),t(169,"td"),n(170,"Tra 3 giorni"),e(),t(171,"td"),n(172,"09:00 - 10:00"),e(),t(173,"td"),n(174,"1h"),e(),t(175,"td")(176,"span",47),n(177,"Confermata"),e()(),t(178,"td")(179,"button",48),n(180,"Annulla"),e()()()()()()()()()(),t(181,"div",51)(182,"div",52)(183,"div",53)(184,"div",54)(185,"h5",55),n(186,"Prossima Prenotazione"),e(),o(187,"button",56),e(),t(188,"div",57)(189,"div",58)(190,"label",59),n(191,"Data"),e(),o(192,"input",60),e(),t(193,"div",61)(194,"div",62)(195,"label",59),n(196,"Ora Inizio"),e(),o(197,"input",63),e(),t(198,"div",62)(199,"label",59),n(200,"Ora Fine"),e(),o(201,"input",64),e()(),t(202,"div",65),o(203,"i",66),t(204,"strong"),n(205,"Durata:"),e(),t(206,"span",67),n(207,"1h"),e()()(),t(208,"div",68)(209,"button",69),n(210,"Chiudi"),e(),t(211,"a",70),n(212,"Vai alle Prenotazioni"),e()()()()(),t(213,"button",71),b("click",function(){return s.scrollToTop()}),o(214,"i",72),e()),a&2&&(l(28),m(s.bookingsCount),l(21),m(s.workoutsCount),l(15),D(s.currentPresenceBadgeClass),l(),m(s.currentPresenceBadge),l(5),m(s.currentPresencesCount))},dependencies:[y,_]})};var H=(r,i)=>{let a=x(L),s=x(T);return a.isAuthenticated()?a.isAdmin()?!0:(s.navigate(["/backoffice/dashboard"]),!1):(s.navigate(["/auth/login"]),!1)};var V=[{path:"",redirectTo:"/auth/login",pathMatch:"full"},{path:"auth",children:[{path:"login",loadComponent:()=>import("./chunk-Q7WMRF7H.js").then(r=>r.LoginComponent)},{path:"registrazione",loadComponent:()=>import("./chunk-QBOGWGIC.js").then(r=>r.RegistrazioneComponent)},{path:"password-reset",loadComponent:()=>import("./chunk-YC5G2TIS.js").then(r=>r.PasswordResetComponent)}]},{path:"backoffice",loadComponent:()=>import("./chunk-7PPNRLM5.js").then(r=>r.BackofficeLayoutComponent),children:[{path:"",redirectTo:"dashboard",pathMatch:"full"},{path:"dashboard",component:g},{path:"gestisci-utenti",loadComponent:()=>import("./chunk-7X2IY6QB.js").then(r=>r.GestisciUtentiComponent)},{path:"gestisci-prenotazioni",loadComponent:()=>import("./chunk-MXAFWLKE.js").then(r=>r.GestisciPrenotazioniComponent)},{path:"registra-utente",loadComponent:()=>import("./chunk-K7C4GVBC.js").then(r=>r.RegistraUtenteComponent)},{path:"registra-operatore",loadComponent:()=>import("./chunk-VCDEFTQM.js").then(r=>r.RegistraOperatoreComponent),canActivate:[H]},{path:"visualizza-operatori",loadComponent:()=>import("./chunk-YV3AY7DU.js").then(r=>r.VisualizzaOperatoriComponent)},{path:"profilo-operatore",loadComponent:()=>import("./chunk-LIXZOCXW.js").then(r=>r.ProfiloOperatoreComponent)},{path:"stampa-qrcode",loadComponent:()=>import("./chunk-JIXTCQUA.js").then(r=>r.StampaQrcodeComponent)},{path:"imposta-margine-entrata",loadComponent:()=>import("./chunk-RBSXRFGM.js").then(r=>r.ImpostaMargineEntrataComponent)},{path:"imposta-capacita-massima",loadComponent:()=>import("./chunk-CDBSFVSW.js").then(r=>r.ImpostaCapacitaMassimaComponent)}]},{path:"**",redirectTo:"/auth/login"}];var F={providers:[w({eventCoalescing:!0}),B(V),I(z())]};M(v,F).catch(r=>console.error(r));
