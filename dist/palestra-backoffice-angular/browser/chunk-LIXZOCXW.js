import{a as K}from"./chunk-HS4QI2UB.js";import{a as A}from"./chunk-Y5DSX2WP.js";import{d as R,e as _,g as F,j as U,k as j,n as G}from"./chunk-MOLSLK7Y.js";import{D as u,E as M,K as v,N as o,O as i,P as l,R as w,U as a,a as d,aa as B,b as I,h as P,i as m,k as f,ka as H,la as k,n as T,q as L,ra as D,s as x}from"./chunk-GFW33JLT.js";var S=class b{constructor(r,e){this.http=r;this.operatorsService=e}API_URL="/api/operator/profile";MOCK_URL="/assets/mock/operator-profile.json";serverAvailable=!0;lastCheck=0;CHECK_INTERVAL=6e4;isServerAvailable(){let r=Date.now();return r-this.lastCheck>this.CHECK_INTERVAL&&(this.lastCheck=r),this.serverAvailable}handleConnectionError(r,e){let t=r.status===0,n=r.message?.includes("parsing")||r.error instanceof ProgressEvent;return t||n?(this.serverAvailable=!1,(this.lastCheck===0||Date.now()-this.lastCheck>this.CHECK_INTERVAL)&&(console.info("Microservizio non disponibile, uso dati mock locali"),this.lastCheck=Date.now()),e()):r.status&&r.status>=400?(this.serverAvailable=!1,(this.lastCheck===0||Date.now()-this.lastCheck>this.CHECK_INTERVAL)&&(console.info("Microservizio non disponibile, uso dati mock locali"),this.lastCheck=Date.now()),e()):(console.warn("Errore nella chiamata al microservizio:",r.message),this.serverAvailable=!1,e())}getProfile(r){return r?this.operatorsService.getOperators().pipe(m(e=>{let t=e.find(s=>s.id.toString()===r.toString());if(!t)throw new Error("Operatore non trovato");return{id:t.id,firstName:t.firstName,lastName:t.lastName,email:t.email,phone:t.phone,birthdate:t.birthdate,birthdateDisplay:t.birthdateDisplay,gender:t.gender,role:t.role}}),f(e=>(console.error("Errore nel recupero dell'operatore:",e),this.getMockProfile(r)))):this.isServerAvailable()?this.http.get(this.API_URL,{headers:{Accept:"application/json"}}).pipe(m(e=>{if(e.success&&e.data)return this.serverAvailable=!0,I(d({},e.data),{birthdateDisplay:e.data.birthdate?new Date(e.data.birthdate).toLocaleDateString("it-IT"):void 0});throw new Error(e.message||"Invalid response format")}),f(e=>e.status===404?(this.serverAvailable=!1,this.getMockProfile()):this.handleConnectionError(e,()=>this.getMockProfile()))):this.getMockProfile()}getMockProfile(r){return r?this.operatorsService.getOperators().pipe(m(e=>{let t=e.find(s=>s.id.toString()===r.toString());if(!t)throw new Error("Operatore non trovato");return{id:t.id,firstName:t.firstName,lastName:t.lastName,email:t.email,phone:t.phone,birthdate:t.birthdate,birthdateDisplay:t.birthdateDisplay,gender:t.gender,role:t.role}}),f(e=>(console.error("Errore nel caricamento del mock:",e),P({id:1,firstName:"Mario",lastName:"Rossi",email:"mario.rossi@email.com",phone:"+39 333 123 4567",birthdate:"1990-05-15",gender:"Maschio",role:"Operatore"})))):this.http.get(this.MOCK_URL).pipe(m(e=>I(d({},e),{birthdateDisplay:e.birthdate?new Date(e.birthdate).toLocaleDateString("it-IT"):void 0})),f(e=>(console.error("Errore nel caricamento del mock:",e),P({id:1,firstName:"Mario",lastName:"Rossi",email:"mario.rossi@email.com",phone:"+39 333 123 4567",birthdate:"1990-05-15",gender:"Maschio",role:"Operatore"}))))}updateProfile(r){return this.isServerAvailable()?this.http.put(this.API_URL,r).pipe(m(e=>{if(e.success&&e.data)return this.serverAvailable=!0,I(d({},e.data),{birthdateDisplay:e.data.birthdate?new Date(e.data.birthdate).toLocaleDateString("it-IT"):void 0});throw new Error(e.message||"Invalid response format")}),f(e=>this.getMockProfile().pipe(m(t=>d(d({},t),r))))):this.getMockProfile().pipe(m(e=>d(d({},e),r)))}changePassword(r,e){return this.isServerAvailable()?this.http.post(`${this.API_URL}/change-password`,{oldPassword:r,newPassword:e}).pipe(m(t=>(this.serverAvailable=!0,t.success)),f(t=>P(!0))):P(!0)}static \u0275fac=function(e){return new(e||b)(L(k),L(K))};static \u0275prov=T({token:b,factory:b.\u0275fac,providedIn:"root"})};var V=class b{constructor(r,e){this.profileService=r;this.authService=e}profile=null;isLoading=!0;editProfile={};ngOnInit(){this.loadProfile()}loadProfile(){this.isLoading=!0;let r=this.authService.getCurrentUser();if(!r||!r.id){console.error("Utente corrente non trovato"),this.isLoading=!1;return}this.profileService.getProfile(r.id).subscribe({next:e=>{this.profile=e,this.editProfile=d({},e),this.isLoading=!1,this.updateUI()},error:e=>{console.error("Errore nel caricamento del profilo:",e),this.isLoading=!1}})}updateUI(){if(!this.profile)return;let r=document.getElementById("displayFirstname"),e=document.getElementById("displayLastname"),t=document.getElementById("displayEmail"),n=document.getElementById("displayPhone"),s=document.getElementById("displayBirthdate"),p=document.getElementById("displayGender"),c=document.querySelector(".fs-17.mb-1"),h=document.querySelector(".text-muted.mb-0");r&&(r.value=this.profile.firstName),e&&(e.value=this.profile.lastName),t&&(t.value=this.profile.email),n&&(n.value=this.profile.phone),s&&(s.value=this.profile.birthdateDisplay||this.profile.birthdate),p&&(p.value=this.profile.gender),c&&(c.textContent=`${this.profile.firstName} ${this.profile.lastName}`),h&&(h.textContent=this.profile.role);let E=document.getElementById("editFirstname"),g=document.getElementById("editLastname"),y=document.getElementById("editEmail"),C=document.getElementById("editPhone"),O=document.getElementById("editBirthdate"),N=document.getElementById("editGender");E&&(E.value=this.profile.firstName),g&&(g.value=this.profile.lastName),y&&(y.value=this.profile.email),C&&(C.value=this.profile.phone),O&&(O.value=this.profile.birthdate),N&&(N.value=this.profile.gender)}saveProfileChanges(){let r=document.getElementById("editFirstname"),e=document.getElementById("editLastname"),t=document.getElementById("editEmail"),n=document.getElementById("editPhone"),s=document.getElementById("editBirthdate"),p=document.getElementById("editGender");if(!r||!e||!t||!n||!s||!p){alert("Errore: campi non trovati");return}let c={firstName:r.value,lastName:e.value,email:t.value,phone:n.value,birthdate:s.value,gender:p.value};this.profileService.updateProfile(c).subscribe({next:h=>{this.profile=h,this.updateUI();let E=document.getElementById("editProfileModal");if(E){let g=window.bootstrap?.Modal;if(g){let y=g.getInstance(E);y&&y.hide()}}alert("\u2713 Profilo aggiornato con successo!")},error:h=>{console.error("Errore nell'aggiornamento del profilo:",h),alert("Errore nell'aggiornamento del profilo. Riprova pi\xF9 tardi.")}})}clearPasswordFields(){let r=document.getElementById("oldpasswordInput"),e=document.getElementById("newpasswordInput"),t=document.getElementById("confirmpasswordInput");r&&(r.value=""),e&&(e.value=""),t&&(t.value="")}changePassword(){let r=document.getElementById("oldpasswordInput"),e=document.getElementById("newpasswordInput"),t=document.getElementById("confirmpasswordInput");if(!r||!e||!t){alert("Errore: campi non trovati");return}let n=r.value,s=e.value,p=t.value;if(!n||!s||!p){alert("Per favore compila tutti i campi!");return}if(s!==p){alert("Le password non corrispondono!");return}if(s.length<8){alert("La password deve essere di almeno 8 caratteri!");return}this.profileService.changePassword(n,s).subscribe({next:c=>{c?(this.clearPasswordFields(),alert("\u2713 Password cambiata con successo!")):alert("Errore nel cambio password. Riprova pi\xF9 tardi.")},error:c=>{console.error("Errore nel cambio password:",c),alert("Errore nel cambio password. Riprova pi\xF9 tardi.")}})}toggleMenu(r,e){r.preventDefault();let t=document.getElementById(e);if(t){let n=window.bootstrap?.Collapse;if(n){let s=new n(t,{toggle:!0})}else t.classList.toggle("show")}}get currentYear(){return new Date().getFullYear()}static \u0275fac=function(e){return new(e||b)(M(S),M(A))};static \u0275cmp=x({type:b,selectors:[["app-profilo-operatore"]],standalone:!0,features:[B],decls:154,vars:6,consts:[[1,"row"],[1,"col-12"],[1,"page-title-box","d-sm-flex","align-items-center","justify-content-between"],[1,"mb-sm-0"],[1,"page-title-right"],[1,"breadcrumb","m-0"],[1,"breadcrumb-item"],["routerLink","/backoffice/dashboard"],[1,"breadcrumb-item","active"],[1,"card"],[1,"card-header"],["role","tablist",1,"nav","nav-tabs-custom","rounded","card-header-tabs","border-bottom-0"],[1,"nav-item"],["data-bs-toggle","tab","href","#personalDetails","role","tab",1,"nav-link","active"],[1,"ri-user-line","me-1","align-bottom"],["data-bs-toggle","tab","href","#changePassword","role","tab",1,"nav-link"],[1,"ri-lock-line","me-1","align-bottom"],[1,"card-body"],[1,"tab-content"],["id","personalDetails","role","tabpanel",1,"tab-pane","active"],[1,"col-lg-6"],[1,"mb-3"],["for","displayFirstname",1,"form-label"],["type","text","id","displayFirstname","disabled","",1,"form-control",3,"value"],["for","displayLastname",1,"form-label"],["type","text","id","displayLastname","disabled","",1,"form-control",3,"value"],["for","displayEmail",1,"form-label"],["type","email","id","displayEmail","disabled","",1,"form-control",3,"value"],["for","displayPhone",1,"form-label"],["type","text","id","displayPhone","disabled","",1,"form-control",3,"value"],["for","displayBirthdate",1,"form-label"],["type","text","id","displayBirthdate","disabled","",1,"form-control",3,"value"],["for","displayGender",1,"form-label"],["type","text","id","displayGender","disabled","",1,"form-control",3,"value"],[1,"col-lg-12"],[1,"d-flex","justify-content-end"],["type","button","data-bs-toggle","modal","data-bs-target","#editProfileModal",1,"btn","btn-primary"],[1,"ri-edit-line","me-1"],["id","changePassword","role","tabpanel",1,"tab-pane"],[3,"ngSubmit"],[1,"row","g-2"],["for","oldpasswordInput",1,"form-label"],["type","password","id","oldpasswordInput","placeholder","Inserisci la vecchia password",1,"form-control"],["for","newpasswordInput",1,"form-label"],["type","password","id","newpasswordInput","placeholder","Inserisci la nuova password",1,"form-control"],["for","confirmpasswordInput",1,"form-label"],["type","password","id","confirmpasswordInput","placeholder","Conferma la nuova password",1,"form-control"],["role","alert",1,"alert","alert-warning","alert-border-left"],[1,"ri-alert-line","me-3","align-middle","fs-16"],[1,"mb-0","mt-2"],[1,"text-end"],["type","button",1,"btn","btn-soft-secondary",3,"click"],["type","submit",1,"btn","btn-primary"],["id","editProfileModal","tabindex","-1","aria-labelledby","editProfileModalLabel","aria-hidden","true",1,"modal","fade"],[1,"modal-dialog","modal-lg"],[1,"modal-content"],[1,"modal-header"],["id","editProfileModalLabel",1,"modal-title"],["type","button","data-bs-dismiss","modal","aria-label","Close",1,"btn-close"],[1,"modal-body"],["id","editProfileForm"],["for","editFirstname",1,"form-label"],["type","text","id","editFirstname","placeholder","Inserisci il tuo nome","value","Mario",1,"form-control"],["for","editLastname",1,"form-label"],["type","text","id","editLastname","placeholder","Inserisci il tuo cognome","value","Rossi",1,"form-control"],["for","editEmail",1,"form-label"],["type","email","id","editEmail","placeholder","Inserisci la tua email","value","mario.rossi@email.com",1,"form-control"],["for","editPhone",1,"form-label"],["type","text","id","editPhone","placeholder","Inserisci il numero di telefono","value","+39 333 123 4567",1,"form-control"],["for","editBirthdate",1,"form-label"],["type","date","id","editBirthdate","value","1990-05-15",1,"form-control"],["for","editGender",1,"form-label"],["id","editGender",1,"form-select"],["value","Maschio","selected",""],["value","Femmina"],["value","Altro"],[1,"modal-footer"],["type","button","data-bs-dismiss","modal",1,"btn","btn-soft-secondary"],["type","button",1,"btn","btn-primary",3,"click"]],template:function(e,t){e&1&&(o(0,"div",0)(1,"div",1)(2,"div",2)(3,"h4",3),a(4,"Profilo Operatore"),i(),o(5,"div",4)(6,"ol",5)(7,"li",6)(8,"a",7),a(9,"Dashboard"),i()(),o(10,"li",8),a(11,"Profilo"),i()()()()()(),o(12,"div",0)(13,"div",1)(14,"div",9)(15,"div",10)(16,"ul",11)(17,"li",12)(18,"a",13),l(19,"i",14),a(20," Dati Personali "),i()(),o(21,"li",12)(22,"a",15),l(23,"i",16),a(24," Cambia Password "),i()()()(),o(25,"div",17)(26,"div",18)(27,"div",19)(28,"div",0)(29,"div",20)(30,"div",21)(31,"label",22),a(32,"Nome"),i(),l(33,"input",23),i()(),o(34,"div",20)(35,"div",21)(36,"label",24),a(37,"Cognome"),i(),l(38,"input",25),i()(),o(39,"div",20)(40,"div",21)(41,"label",26),a(42,"Email"),i(),l(43,"input",27),i()(),o(44,"div",20)(45,"div",21)(46,"label",28),a(47,"Telefono"),i(),l(48,"input",29),i()(),o(49,"div",20)(50,"div",21)(51,"label",30),a(52,"Data di Nascita"),i(),l(53,"input",31),i()(),o(54,"div",20)(55,"div",21)(56,"label",32),a(57,"Sesso"),i(),l(58,"input",33),i()(),o(59,"div",34)(60,"div",35)(61,"button",36),l(62,"i",37),a(63," Modifica "),i()()()()(),o(64,"div",38)(65,"form",39),w("ngSubmit",function(s){return t.changePassword(),s.preventDefault()}),o(66,"div",40)(67,"div",34)(68,"div",21)(69,"label",41),a(70,"Vecchia Password*"),i(),l(71,"input",42),i()(),o(72,"div",20)(73,"div",21)(74,"label",43),a(75,"Nuova Password*"),i(),l(76,"input",44),i()(),o(77,"div",20)(78,"div",21)(79,"label",45),a(80,"Conferma Password*"),i(),l(81,"input",46),i()(),o(82,"div",34)(83,"div",21)(84,"div",47),l(85,"i",48),o(86,"strong"),a(87,"Requisiti Password"),i(),o(88,"ul",49)(89,"li"),a(90,"Minimo 8 caratteri"),i(),o(91,"li"),a(92,"Almeno una lettera maiuscola"),i(),o(93,"li"),a(94,"Almeno un numero"),i(),o(95,"li"),a(96,"Almeno un carattere speciale (!@#$%^&*)"),i()()()()(),o(97,"div",34)(98,"div",50)(99,"button",51),w("click",function(){return t.clearPasswordFields()}),a(100,"Annulla"),i(),o(101,"button",52),a(102,"Cambia Password"),i()()()()()()()()()()(),o(103,"div",53)(104,"div",54)(105,"div",55)(106,"div",56)(107,"h5",57),a(108,"Modifica Dati Personali"),i(),l(109,"button",58),i(),o(110,"div",59)(111,"form",60)(112,"div",0)(113,"div",20)(114,"div",21)(115,"label",61),a(116,"Nome"),i(),l(117,"input",62),i()(),o(118,"div",20)(119,"div",21)(120,"label",63),a(121,"Cognome"),i(),l(122,"input",64),i()(),o(123,"div",20)(124,"div",21)(125,"label",65),a(126,"Email"),i(),l(127,"input",66),i()(),o(128,"div",20)(129,"div",21)(130,"label",67),a(131,"Telefono"),i(),l(132,"input",68),i()(),o(133,"div",20)(134,"div",21)(135,"label",69),a(136,"Data di Nascita"),i(),l(137,"input",70),i()(),o(138,"div",20)(139,"div",21)(140,"label",71),a(141,"Sesso"),i(),o(142,"select",72)(143,"option",73),a(144,"Maschio"),i(),o(145,"option",74),a(146,"Femmina"),i(),o(147,"option",75),a(148,"Altro"),i()()()()()()(),o(149,"div",76)(150,"button",77),a(151,"Annulla"),i(),o(152,"button",78),w("click",function(){return t.saveProfileChanges()}),a(153,"Salva"),i()()()()()),e&2&&(u(33),v("value",(t.profile==null?null:t.profile.firstName)||""),u(5),v("value",(t.profile==null?null:t.profile.lastName)||""),u(5),v("value",(t.profile==null?null:t.profile.email)||""),u(5),v("value",(t.profile==null?null:t.profile.phone)||""),u(5),v("value",(t.profile==null?null:t.profile.birthdateDisplay)||(t.profile==null?null:t.profile.birthdate)||""),u(5),v("value",(t.profile==null?null:t.profile.gender)||""))},dependencies:[H,D,G,F,U,j,R,_]})};export{V as ProfiloOperatoreComponent};
